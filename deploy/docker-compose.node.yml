version: '3.8'

services:
  provchain-node:
    # Uncomment below to use prebuilt image from Docker Hub
    image: anusornc/provchain-org:latest
    # Comment out the 'build' section when using prebuilt image
    # build:
    #   context: ..
    #   dockerfile: deploy/Dockerfile.production
    container_name: provchain-node
    restart: unless-stopped
    ports:
      - "8080:8080"  # API & P2P Port
      - "9090:9090"  # Metrics Port
    environment:
      - RUST_LOG=${RUST_LOG:-info}
      - JWT_SECRET=${JWT_SECRET:-change_this_secret_in_production}
      - CONFIG_FILE=/app/config/production-deployment.toml
      - PROVCHAIN_PEERS=${PEERS:-}
      - PROVCHAIN_PORT=8080
      # Optional: Set this if Jaeger is running on a specific host (e.g., the monitoring node)
      - OTEL_EXPORTER_JAEGER_ENDPOINT=${JAEGER_ENDPOINT:-}
    volumes:
      - ./node_data:/app/data
      - ./node_logs:/app/logs
    # Host networking is often simpler for P2P but bridge is standard for Docker.
    # With bridge, other nodes connect to HOST_IP:8080, which maps to Container:8080.
    networks:
      - provchain_net

networks:
  provchain_net:
    driver: bridge
