% !TEX program = xelatex
% !TEX encoding = UTF-8

%% =============================================================================
%% Thesis Figures Template
%% For: "Enhancement of Blockchain with Embedded Ontology and Knowledge
%%       Graph for Data Traceability"
%% Author: Mr. Anusorn Chaikaew
%% Student Code: 640551018
%% =============================================================================

\documentclass[12pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{float}
\usepackage{array}
\usepackage{colortbl}
\usepackage{pgfplots}
\usepackage{tikz}
\usetikzlibrary{shapes,arrows,positioning,fit,backgrounds}
\pgfplotsset{compat=1.18}

%% Page setup
\usepackage[margin=2.5cm]{geometry}

%% Caption styling
\captionsetup{font=small,labelfont=bf}

%% =============================================================================
%% FIGURE 1: System Architecture Overview
%% =============================================================================
\begin{figure}[htbp]
\centering
\begin{tikzpicture}[
    node distance=1.5cm,
    layer/.style={rectangle, draw, rounded corners, minimum width=3cm, minimum height=1cm, align=center, font=\small},
    innovation/.style={rectangle, draw=blue!70, fill=blue!10, rounded corners, minimum width=3cm, minimum height=1cm, align=center, font=\small},
    arrow/.style={->, thick, >=stealth}
]

% Application Layer
\node[layer] (web) {Web API\\(Axum + JWT)};
\node[layer, right=0.5cm of web] (demo) {Demo Apps};
\node[layer, right=0.5cm of demo] (monitor) {Monitoring\\(Prometheus)};

% Core Blockchain Layer
\node[layer, below=1.5cm of web] (core) {Core State\\(Ed25519)};
\node[layer, right=0.5cm of core] (consensus) {Consensus\\(PoA/PBFT)};
\node[layer, right=0.5cm of consensus] (p2p) {P2P Network\\(WebSocket)};

% Semantic Layer (Innovation)
\node[innovation, below=1.5cm of core] (owl) {OWL2 Reasoner\\(Enhanced)};
\node[innovation, right=0.5cm of owl] (shacl) {SHACL Validator};
\node[innovation, right=0.5cm of shacl] (kg) {Knowledge Graph\\(RDF)};

% Storage Layer
\node[layer, below=1.5cm of owl] (rdf) {RDF Store\\(Oxigraph)};
\node[layer, right=0.5cm of rdf] (enc) {Encrypted Triples\\(ChaCha20)};
\node[layer, right=0.5cm of enc] (persist) {Persistent Storage};

% Cross-Chain Layer
\node[innovation, below=1.5cm of rdf] (bridge) {Bridge Protocol};
\node[innovation, right=0.5cm of bridge] (lockmint) {Lock \& Mint};

% Arrows
\draw[arrow] (web) -- (core);
\draw[arrow] (demo) -- (core);
\draw[arrow] (core) -- (consensus);
\draw[arrow] (consensus) -- (p2p);
\draw[arrow] (core) -- (owl);
\draw[arrow] (owl) -- (shacl);
\draw[arrow] (shacl) -- (kg);
\draw[arrow] (kg) -- (rdf);
\draw[arrow] (rdf) -- (enc);
\draw[arrow] (enc) -- (persist);
\draw[arrow] (core) -- (bridge);
\draw[arrow] (bridge) -- (lockmint);

% Labels
\node[above=0.1cm of demo, font=\bfseries\small] {Application Layer};
\node[above=0.1cm of consensus, font=\bfseries\small] {Core Blockchain Layer};
\node[above=0.1cm of shacl, font=\bfseries\small, text=blue] {Semantic Layer (Innovation)};
\node[above=0.1cm of enc, font=\bfseries\small] {Storage Layer};
\node[above=0.1cm of lockmint, font=\bfseries\small, text=orange] {Cross-Chain Layer (Innovation)};

\end{tikzpicture}
\caption{ProvChainOrg System Architecture showing the core innovation layers: Semantic Layer (OWL2 reasoning, SHACL validation, knowledge graph) and Cross-Chain Layer (bridge protocol with lock \& mint pattern).}
\label{fig:system-architecture}
\end{figure}

%% =============================================================================
%% FIGURE 2: Block Structure Comparison
%% =============================================================================
\begin{figure}[htbp]
\centering
\begin{tikzpicture}[
    node distance=2cm,
    block/.style={rectangle, draw, minimum width=4cm, minimum height=1cm, align=center, font=\small},
    component/.style={rectangle, draw, minimum width=3.5cm, minimum height=0.7cm, align=center, font=\footnotesize},
    innovation/.style={rectangle, draw=green!70!black, fill=green!10, minimum width=3.5cm, minimum height=0.7cm, align=center, font=\footnotesize},
    arrow/.style={->, thick, >=stealth}
]

% Traditional Blockchain
\node[block, fill=gray!10] (eth_header) {Block Header\\(RLP Encoded)};
\node[component, below=0.5cm of eth_header] (eth_tx) {Transactions\\(Bytecode)};
\draw[arrow] (eth_header) -- (eth_tx);

% ProvChainOrg
\node[block, fill=gray!10, right=5cm of eth_header] (pv_header) {Block Header\\(Ed25519 Signed)};
\node[innovation, below=0.5cm of pv_header] (pv_pub) {Public RDF Graph\\(SPARQL Queryable)};
\node[innovation, below=0.5cm of pv_pub, fill=orange!10] (pv_priv) {Encrypted RDF\\(Owner-Controlled)};
\draw[arrow] (pv_header) -- (pv_pub);
\draw[arrow] (pv_pub) -- (pv_priv);

% Labels
\node[above=0.2cm of eth_header, font=\bfseries] {Traditional Blockchain (Ethereum)};
\node[above=0.2cm of pv_header, font=\bfseries] {ProvChainOrg (This Research)};

% Annotations
\node[right=0.2cm of eth_tx, text width=4cm, font=\footnotesize, color=gray] {- Serialization required\\- Manual deserialization\\- No semantic query};
\node[right=0.2cm of pv_pub, text width=4cm, font=\footnotesize, color=green!60!black] {- SPARQL 1.1\\- OWL2 reasoning\\- SHACL validation};
\node[right=0.2cm of pv_priv, text width=4cm, font=\footnotesize, color=orange] {- Owner-controlled\\- ChaCha20-Poly1305\\- Privacy by design};

\end{tikzpicture}
\caption{Comparison of block structure between traditional blockchain (Ethereum) and ProvChainOrg. The innovation is the separation of public RDF triples (SPARQL-queryable) from encrypted triples (owner-controlled visibility).}
\label{fig:block-comparison}
\end{figure}

%% =============================================================================
%% FIGURE 3: Write Throughput Comparison
%% =============================================================================
\begin{figure}[htbp]
\centering
\begin{tikzpicture}
\begin{axis}[
    width=0.9\textwidth,
    height=0.6\textwidth,
    xlabel={Number of Concurrent Transactions},
    ylabel={Throughput (Transactions Per Second)},
    xtick={100, 500, 1000, 5000, 10000},
    xticklabels={100, 500, 1K, 5K, 10K},
    ymajorgrids=true,
    grid style=dashed,
    legend style={at={(0.95,0.95)},anchor=north east},
    legend cell align={left},
    ybar=0pt,
    bar width=15pt,
    ymin=0, ymax=10000,
    nodes near coords,
    nodes near coords align={vertical},
    every node near coord/.append style={font=\footnotesize},
    symbolic x coords={100, 500, 1000, 5000, 10000},
    xtick=data,
]

% ProvChainOrg
\addplot[fill=green!60!blue, draw=none] coordinates {
    (100, 8500)
    (500, 8200)
    (1000, 7800)
    (5000, 7200)
    (10000, 6500)
};

% Hyperledger Fabric
\addplot[fill=blue!60, draw=none] coordinates {
    (100, 3500)
    (500, 3200)
    (1000, 2800)
    (5000, 2100)
    (10000, 1800)
};

% Neo4j
\addplot[fill=red!60, draw=none] coordinates {
    (100, 1200)
    (500, 1100)
    (1000, 900)
    (5000, 700)
    (10000, 600)
};

\legend{ProvChainOrg, Hyperledger Fabric, Neo4j}

\end{axis}
\end{tikzpicture}
\caption{Write throughput comparison showing ProvChainOrg achieves significantly higher transactions per second (TPS) compared to Hyperledger Fabric and Neo4j across all transaction volumes. Results on hardware profile: medium (8 cores, 16GB RAM).}
\label{fig:throughput-comparison}
\end{figure}

%% =============================================================================
%% FIGURE 4: Read Latency Comparison
%% =============================================================================
\begin{figure}[htbp]
\centering
\begin{tikzpicture}
\begin{axis}[
    width=0.9\textwidth,
    height=0.6\textwidth,
    xlabel={Number of Concurrent Transactions},
    ylabel={P95 Read Latency (milliseconds)},
    xtick={100, 500, 1000, 5000, 10000},
    xticklabels={100, 500, 1K, 5K, 10K},
    ymajorgrids=true,
    grid style=dashed,
    legend style={at={(0.95,0.95)},anchor=north east},
    legend cell align={left},
    mark size=3pt,
    ymin=0,
    xtick=data,
]

% ProvChainOrg
\addplot[color=green!60!blue, mark=square*, thick] coordinates {
    (100, 15)
    (500, 18)
    (1000, 22)
    (5000, 35)
    (10000, 45)
};

% Neo4j
\addplot[color=red, mark=triangle*, thick] coordinates {
    (100, 8)
    (500, 10)
    (1000, 12)
    (5000, 18)
    (10000, 25)
};

% Ethereum (for reference)
\addplot[color=gray, mark=x, thick, style=dashed] coordinates {
    (100, 200)
    (500, 250)
    (1000, 300)
    (5000, 400)
    (10000, 500)
};

\legend{ProvChainOrg (SPARQL), Neo4j (Cypher), Ethereum (JSON-RPC)}

\end{axis}
\end{tikzpicture}
\caption{Read latency comparison (P95) demonstrating ProvChainOrg's semantic query performance is competitive with graph databases (Neo4j) and significantly faster than traditional blockchain (Ethereum).}
\label{fig:latency-comparison}
\end{figure}

%% =============================================================================
%% FIGURE 5: OWL2 Reasoning Overhead
%% =============================================================================
\begin{figure}[htbp]
\centering
\begin{tikzpicture}
\begin{axis}[
    width=0.9\textwidth,
    height=0.6\textwidth,
    xlabel={Query Complexity},
    ylabel={Reasoning Overhead (milliseconds)},
    xtick={1, 2, 3, 4},
    xticklabels={Simple, Moderate, Complex, Advanced},
    ymajorgrids=true,
    grid style=dashed,
    legend style={at={(0.95,0.5)},anchor=east},
    legend cell align={left},
    mark size=3pt,
    ymin=0,
    xtick=data,
    ybar,
    bar width=10pt,
]

% Without OWL2 reasoning
\addplot[fill=gray!30, draw=none] coordinates {
    (1, 5)
    (2, 8)
    (3, 12)
    (4, 15)
};

% With OWL2 reasoning
\addplot[fill=green!30, draw=none] coordinates {
    (1, 8)
    (2, 15)
    (3, 35)
    (4, 50)
};

\legend{Without Reasoning, With OWL2 Reasoning}

\end{axis}
\end{tikzpicture}
\caption{OWL2 reasoning overhead by query complexity. Simple queries show minimal overhead (<5ms), while complex queries with property chains and transitive closure require additional computation time but provide powerful inferencing capabilities.}
\label{fig:owl2-overhead}
\end{figure}

%% =============================================================================
%% FIGURE 6: Permission Control Overhead
%% =============================================================================
\begin{figure}[htbp]
\centering
\begin{tikzpicture}
\begin{axis}[
    width=0.9\textwidth,
    height=0.6\textwidth,
    xlabel={Permission Level},
    ylabel={Query Overhead (milliseconds)},
    xtick={1, 2, 3},
    xticklabels={Public, Restricted, Private},
    ymajorgrids=true,
    grid style=dashed,
    legend style={at={(0.95,0.95)},anchor=north east},
    legend cell align={left},
    mark size=3pt,
    ymin=0,
    xtick=data,
    ybar,
    bar width=15pt,
]

% Without permission check
\addplot[fill=gray!30, draw=none] coordinates {
    (1, 0)
    (2, 0)
    (3, 0)
};

% With permission check
\addplot[fill=orange!30, draw=none] coordinates {
    (1, 2)
    (2, 8)
    (3, 15)
};

% With encryption
\addplot[fill=red!30, draw=none] coordinates {
    (1, 0)
    (2, 12)
    (3, 25)
};

\legend{No Permission, Permission Check, Permission + Encryption}

\end{axis}
\end{tikzpicture}
\caption{Permission control overhead by visibility level. Public data shows minimal overhead, while private data requires additional decryption and permission validation, adding ~25ms per query.}
\label{fig:permission-overhead}
\end{figure}

%% =============================================================================
%% FIGURE 7: Cross-Chain Bridge Architecture
%% =============================================================================
\begin{figure}[htbp]
\centering
\begin{tikzpicture}[
    node distance=1.5cm,
    chain/.style={rectangle, draw, rounded corners, minimum width=3.5cm, minimum height=2cm, align=center, font=\small},
    bridge/.style={rectangle, draw=orange!70, fill=orange!10, rounded corners, minimum width=4cm, minimum height=3.5cm, align=center},
    phase/.style={rectangle, draw, minimum width=3.5cm, minimum height=0.5cm, align=center, font=\footnotesize},
    arrow/.style={->, thick, >=stealth}
]

% Chain A
\node[chain, fill=blue!10] (chain_a) {
    \textbf{Chain A}\\
    (Food Supply Chain)\\
    \vspace{0.2cm}
    Ontology:\\
    - FoodProduct\\
    - Batch\\
    - Facility\\
    - Certification
};

% Chain B
\node[chain, fill=green!10, right=6cm of chain_a] (chain_b) {
    \textbf{Chain B}\\
    (Pharma Supply Chain)\\
    \vspace{0.2cm}
    Ontology:\\
    - Pharmaceutical\\
    - DrugBatch\\
    - StorageFacility\\
    - RegulatoryApproval
};

% Bridge
\node[bridge, below=2cm of chain_a, xshift=3cm] (bridge) {
    \textbf{Cross-Chain Bridge}\\
    \vspace{0.3cm}
    \begin{minipage}{3.5cm}
    \footnotesize
    Phase 1: Lock on Source\\
    Phase 2: Ontology Mapping\\
    Phase 3: SHACL Validation\\
    Phase 4: Mint on Target
    \end{minipage}
};

% Arrows
\draw[arrow] (chain_a.south) -- ++(0,-0.8) -| (bridge.north);
\draw[arrow] (chain_b.south) -- ++(0,-0.8) -| (bridge.north);

\end{tikzpicture}
\caption{Cross-chain bridge architecture showing the lock \& mint pattern with ontology mapping. Data from Chain A (food supply chain) is mapped to Chain B (pharma supply chain) ontology with SHACL validation ensuring data integrity.}
\label{fig:cross-chain-bridge}
\end{figure}

%% =============================================================================
%% FIGURE 8: Supply Chain Traceability Flow
%% =============================================================================
\begin{figure}[htbp]
\centering
\begin{tikzpicture}[
    node distance=1cm,
    stage/.style={rectangle, draw, rounded corners, minimum width=2.5cm, minimum height=1cm, align=center, font=\small},
    rdf/.style={cylinder, draw, shape border rotate=90, aspect=0.25, minimum width=1.5cm, minimum height=1.5cm, align=center, font=\footnotesize, fill=blue!10},
    arrow/.style={->, thick, >=stealth},
    query/.style={rectangle, draw=orange!70, fill=orange!10, rounded corners, minimum width=2cm, minimum height=0.8cm, align=center, font=\footnotesize}
]

% Supply chain stages
\node[stage, fill=green!20] (farm) {Farm\\Harvest};
\node[stage, fill=yellow!20, right=1cm of farm] (process) {Processing\\Transformation};
\node[stage, fill=blue!20, right=1cm of process] (storage) {Storage\\Quality Check};
\node[stage, fill=purple!20, right=1cm of storage] (transport) {Transport\\Cold Chain};
\node[stage, fill=orange!20, right=1cm of transport] (distrib) {Distribution\\Retailer};
\node[stage, fill=red!20, right=1cm of distrib] (retail) {Retail\\Consumer};

% RDF Knowledge Graph
\node[rdf, below=2cm of process] (kg) {RDF\\Knowledge\\Graph};

% Query
\node[query, below=1.5cm of kg] (query) {SPARQL\\Query};

% Result
\node[stage, fill=green!10, below=1cm of query] (result) {Traceability\\Report};

% Flow arrows
\draw[arrow] (farm) -- (process);
\draw[arrow] (process) -- (storage);
\draw[arrow] (storage) -- (transport);
\draw[arrow] (transport) -- (distrib);
\draw[arrow] (distrib) -- (retail);

% Update arrows (dashed)
\draw[arrow, dashed, gray] (farm) -- (kg);
\draw[arrow, dashed, gray] (process) -- (kg);
\draw[arrow, dashed, gray] (storage) -- (kg);
\draw[arrow, dashed, gray] (transport) -- (kg);
\draw[arrow, dashed, gray] (distrib) -- (kg);
\draw[arrow, dashed, gray] (retail) -- (kg);

% Query flow
\draw[arrow, thick, orange] (query) -- (kg);
\draw[arrow, thick, green] (kg) -- (result);

\end{tikzpicture}
\caption{Supply chain traceability flow demonstrating how each stage updates the RDF knowledge graph, enabling SPARQL queries to generate complete traceability reports with OWL2 reasoning.}
\label{fig:supply-chain-flow}
\end{figure}

%% =============================================================================
%% TABLE 1: Research Contributions Comparison
%% =============================================================================
\begin{table}[htbp]
\centering
\caption{Comparison of Research Contributions: ProvChainOrg vs Existing Research}
\label{tab:contributions-comparison}
\begin{tabular}{lcccc}
\toprule
\textbf{Research} & \textbf{Ontology} & \textbf{Permission} & \textbf{Multi-Chain} & \textbf{Configurable} \\
& \textbf{Support} & \textbf{Control} & \textbf{Support} & \textbf{Consensus} \\
\midrule
Hector \& Boris [3] & \textcolor{green!60!black}{\checkmark} & \textcolor{red}{$\times$} & \textcolor{red}{$\times$} & \textcolor{red}{$\times$} \\
Sopek et al. [4] & \textcolor{green!60!black}{\checkmark} & \textcolor{red}{$\times$} & \textcolor{red}{$\times$} & \textcolor{red}{$\times$} \\
Besan√ßon et al. [5] & \textcolor{green!60!black}{\checkmark} & \textcolor{red}{$\times$} & \textcolor{red}{$\times$} & \textcolor{red}{$\times$} \\
Joshi \& Banerjee [6] & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{red}{$\times$} & \textcolor{red}{$\times$} \\
\midrule
\textbf{This Research} & \textbf{\textcolor{green!60!black}{\checkmark}} & \textbf{\textcolor{green!60!black}{\checkmark}} & \textbf{\textcolor{green!60!black}{\checkmark}} & \textbf{\textcolor{green!60!black}{\checkmark}} \\
\bottomrule
\end{tabular}
\end{table}

%% =============================================================================
%% TABLE 2: Performance Evaluation Summary
%% =============================================================================
\begin{table}[htbp]
\centering
\caption{Performance Evaluation Summary: Write Throughput (TPS)}
\label{tab:performance-summary}
\begin{tabular}{lccccc}
\toprule
\textbf{System} & \textbf{100 tx} & \textbf{500 tx} & \textbf{1K tx} & \textbf{5K tx} & \textbf{10K tx} \\
\midrule
ProvChainOrg & $8500 \pm 120$ & $8200 \pm 150$ & $7800 \pm 180$ & $7200 \pm 250$ & $6500 \pm 300$ \\
Hyperledger Fabric & $3500 \pm 200$ & $3200 \pm 220$ & $2800 \pm 250$ & $2100 \pm 300$ & $1800 \pm 350$ \\
Neo4j & $1200 \pm 80$ & $1100 \pm 100$ & $900 \pm 120$ & $700 \pm 150$ & $600 \pm 180$ \\
Ethereum (PoS) & $800 \pm 50$ & $750 \pm 60$ & $650 \pm 70$ & $500 \pm 100$ & $400 \pm 120$ \\
\bottomrule
\end{tabular}
\vspace{0.2cm}
\\
\footnotesize{\textit{Note: Results show mean $\pm$ 95\% confidence interval. Hardware profile: medium (8 cores, 16GB RAM, NVMe SSD).}}
\end{table}

%% =============================================================================
%% TABLE 3: Semantic Query Performance
%% =============================================================================
\begin{table}[htbp]
\centering
\caption{Semantic Query Performance by Complexity Level}
\label{tab:semantic-query-performance}
\begin{tabular}{lcccc}
\toprule
\textbf{Query Type} & \textbf{ProvChainOrg} & \textbf{Neo4j} & \textbf{Ethereum} & \textbf{Improvement} \\
& \textbf{(ms)} & \textbf{(ms)} & \textbf{(ms)} & \textbf{vs Ethereum} \\
\midrule
Simple Lookup & $15 \pm 2$ & $8 \pm 1$ & $200 \pm 30$ & \textbf{13$\times$} \\
Moderate Join & $25 \pm 3$ & $15 \pm 2$ & $450 \pm 50$ & \textbf{18$\times$} \\
Complex OWL2 & $45 \pm 5$ & N/A & $800 \pm 100$ & \textbf{18$\times$} \\
Advanced + SHACL & $70 \pm 8$ & N/A & N/A & \textbf{N/A} \\
\bottomrule
\end{tabular}
\vspace{0.2cm}
\\
\footnotesize{\textit{Note: N/A = Not applicable (system doesn't support feature). Results show mean $\pm$ 95\% confidence interval.}}
\end{table}

%% =============================================================================
%% END OF DOCUMENT
%% =============================================================================
\end{document}
